{"version":3,"sources":["inspector.js"],"names":[],"mappings":"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","file":"inspector.js","sourcesContent":["import { keys, onKey, onKeyDown } from './keys'\nimport inspecting from './lib/inspecting'\nimport { throttle } from 'lodash'\n\nconst removeHead = ([l, ...ls]) => ls\nconst isAlt = cb => e => e.keyIdentifier === 'Alt' && cb()\nconst isEsc = cb => e => e.keyCode === 27 && cb()\n\nconst setLocal = (k,v) => localStorage.setItem(`__flint.state.${k}`, JSON.stringify(v))\nconst getLocal = (k,d) => JSON.parse(localStorage.getItem(`__flint.state.${k}`)) || d\n\nconst round = Math.round\n\nlet highlighter\n\nfunction positionHighlight(node) {\n  const bounds = node.getBoundingClientRect()\n  const winW = window.innerWidth\n  const winH = window.innerHeight\n  const width = round(bounds.right - bounds.left)\n  const height = round(bounds.bottom - bounds.top)\n  let opacity = 1\n\n  if (width >= winW && height >= winH)\n    opacity = 0.2\n\n  highlighter.setAttribute('style', `\n    top: ${round(bounds.top)}px;\n    left: ${round(bounds.left)}px;\n    width: ${width}px;\n    height: ${height}px;\n    opacity: ${opacity};\n  `)\n}\n\nfunction hideHighlight() {\n  highlighter.setAttribute('style', '')\n}\n\nfunction findPath(node) {\n  if (!node || !node.getAttribute) return null\n  const flintid = node.__flintID\n  if (!flintid) return findPath(node.parentNode)\n  positionHighlight(node)\n  return flintid\n}\n\nfunction tempActive(views) {\n  return views.filter(v => !v.temp).length > 0\n}\n\nfunction pathActive(views, path) {\n  return views.filter(v => v.path == path).length > 0\n}\n\nfunction removeTemp(views) {\n  return views.filter(v => !v.temp).map(v => ({ ...v, highlight: false }))\n}\n\nfunction addTemp(views, path) {\n  return [{ path, highlight: false, temp: true }].concat(views)\n}\n\nfunction setClosing(views, path) {\n  return views.map(v => {\n    if (v.path == path) v.closing = true\n    return v\n  })\n}\n\nfunction highlightPath(views, path) {\n  return views.map((v) => {\n    if (v.path == path) v.highlight = true\n    return v\n  })\n}\n\nfunction toggleView(views, path) {\n  if (pathActive(views, path)) {\n    return views.map(v => {\n      if (v.path == path) v.temp = true\n      return v\n    })\n  }\n  else {\n    let added = { temp: false, highlight: false, closing: false, path }\n    return [].concat([added], views)\n  }\n}\n\nfunction internal() {\n  return window._Flint\n}\n\nfunction writeBack(path, writePath) {\n  let Int = internal()\n  let cache = Int.getCache[path]\n\n  // update getCache\n  writePath.reduce((acc, cur) => {\n    if (cur == 'root') return acc\n\n    if (!Array.isArray(cur))\n      return acc[cur]\n\n    // is end of path: [key, val]\n    let [ key, val ] = cur\n    let current = acc[key]\n\n    if (typeof current == 'number')\n      val = +val\n\n    // write\n    acc[key] = val\n  }, cache)\n\n  Int.inspectorRefreshing = path\n  Int.getInitialStates[path]()\n  Int.viewsAtPath[path].forceUpdate()\n  Int.inspectorRefreshing = null\n}\n\nview Inspector {\n  let clickOff, hoverOff, lastTarget\n  let hudActive = false\n  let views = []\n\n  on.mount(() => {\n    hoverOff = on.mousemove(window, throttle(mouseMove, 40))\n    if (highlighter) return\n    highlighter = document.createElement('div')\n    highlighter.className = \"_flintHighlighter\"\n    document.body.appendChild(highlighter)\n  })\n\n  // key events\n  onKeyDown('esc', closeLast)\n\n  let offAlt\n\n  const keysCorrect = ({ altKey, metaKey }) => altKey && !metaKey\n\n  function checkInspect(e) {\n    if (keysCorrect(e)) {\n      // wait a little so were not toooo eager\n      offAlt = on.delay(180, () => {\n        if (keysCorrect(e)) { showInspect() }\n      })\n    } else {\n      offAlt && offAlt()\n      hideInspect()\n    }\n  }\n\n  on.keydown(window, checkInspect)\n  on.keyup(window, checkInspect)\n\n  function inspect(target) {\n    internal().isInspecting = true\n    let path = findPath(target)\n    if (path === null) return\n    views = removeTemp(views)\n    views = pathActive(views, path) ?\n      highlightPath(views, path) :\n      addTemp(views, path)\n  }\n\n  function mouseMove({ target }) {\n    const inspector = ReactDOM.findDOMNode(view)\n\n    if (lastTarget != target) {\n      if (inspector.contains(target))\n        return\n\n      lastTarget = target\n      inspecting.set(target)\n      if (hudActive)\n        inspect(lastTarget)\n    }\n  }\n\n  function closeLast() {\n    if (!views.length) return\n    views = removeHead(views)\n  }\n\n  function close(path, e) {\n    if (e) e.stopPropagation()\n    views = setClosing(views, path)\n\n    on.delay(200, () => {\n      views = views.filter(v => path != v.path)\n    })\n  }\n\n  function glue({ target }) {\n    const inspector = ReactDOM.findDOMNode(view)\n    if (inspector.contains(target)) return\n\n    views = toggleView(removeTemp(views), findPath(target))\n    return false\n  }\n\n  function showInspect() {\n    inspect(lastTarget)\n    hudActive = true\n    clickOff = on.click(window, glue)\n  }\n\n  function hideInspect() {\n    internal().isInspecting = false\n    hudActive = false\n    hideHighlight()\n    clickOff && clickOff()\n    views = removeTemp(views)\n  }\n\n  function onWriteBack(path, data) {\n    writeBack(path, data)\n    view.update()\n  }\n\n; <Inspector.View\n    repeat={views}\n    key={_.path}\n    {..._}\n    writeBack={onWriteBack}\n    onClose={e => close(_.path, e)}\n  />\n\n  $ = {\n    position: 'fixed',\n    top: 0, right: 0,\n    padding: 2\n  }\n}\n"],"sourceRoot":"/source/"}